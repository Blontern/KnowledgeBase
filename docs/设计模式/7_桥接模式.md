## 背景故事

假设你正在开发一个图形绘制库，需要支持：

- 不同形状（如圆形、矩形、三角形…）
- 多种绘图设备（如 Windows、macOS、Linux 平台）

如果你将“形状”与“平台”都硬编码在一个类里，会出现什么问题？

> 每增加一种平台或一种形状，就需要为所有组合编写类：  
> `WindowsCircle`、`MacCircle`、`LinuxRectangle` ……  
> 这将导致**类爆炸**问题（笛卡尔积增长），维护成本急剧上升。

桥接模式通过**抽象和实现的分离**，优雅解决这个问题。  
它像桥梁一样，把两个变化维度“解耦”，各自独立演化。

## 代码演示

抽象实现接口（实现层）

```cs
public interface IDrawingAPI
{
    void DrawCircle(float x, float y, float radius);
}
```

具体实现类（平台层）

```cs
public class WindowsAPI : IDrawingAPI
{
    public void DrawCircle(float x, float y, float radius)
        => Console.WriteLine($"在 Windows 上绘制圆：中心({x},{y}), 半径 {radius}");
}

public class MacAPI : IDrawingAPI
{
    public void DrawCircle(float x, float y, float radius)
        => Console.WriteLine($"在 macOS 上绘制圆：中心({x},{y}), 半径 {radius}");
}
```

抽象类（形状层）

```cs
public abstract class Shape
{
    protected IDrawingAPI drawingAPI;

    public Shape(IDrawingAPI drawingAPI)
    {
        this.drawingAPI = drawingAPI;
    }

    public abstract void Draw();
}
```

扩展抽象类（具体形状）

```cs
public class Circle : Shape
{
    private float x, y, radius;

    public Circle(float x, float y, float radius, IDrawingAPI api)
        : base(api)
    {
        this.x = x;
        this.y = y;
        this.radius = radius;
    }

    public override void Draw()
    {
        drawingAPI.DrawCircle(x, y, radius);
    }
}
```

客户端调用

```cs
class Program
{
    static void Main()
    {
        Shape winCircle = new Circle(5, 10, 3, new WindowsAPI());
        Shape macCircle = new Circle(2, 4, 1, new MacAPI());

        winCircle.Draw();
        macCircle.Draw();
    }
}
```


## 定义

> **桥接模式（Bridge）**：将抽象部分与实现部分分离，使它们都可以独立变化。

本质是**结构解耦**：抽象不再绑定于固定实现，而是通过接口桥接。

<import filepath="./UML/7.puml" />

## 应用场景

- 系统中存在多个“变化方向”（如类型+平台）
- 希望分离抽象与实现，独立扩展、组合
- 类爆炸风险严重（组合过多）

系统需要在多个平台之间独立变化时，或者有多种产品、平台、功能组合时，需要解耦接口和实现的细节时：

**场景 1：图形绘制器**

抽象：形状（圆形、矩形）  
实现：绘图 API（OpenGL、DirectX）

**场景 2：消息发送系统**

抽象：消息类型（普通消息、加急消息）  
实现：发送渠道（Email、短信、微信）

**场景 3：数据库访问层**

抽象：数据操作（增删改查）  
实现：底层数据库（MySQL、MongoDB、PostgreSQL）

## 总结

优点
- **解耦两个变化维度**：抽象与实现可独立扩展
- **遵循开闭原则**：新增平台或形状无需改动原逻辑
- **结构清晰**：职责分明，接口设计更清楚

缺点
- **结构略复杂**：引入多层接口
- **开发初期成本稍高**：需要提前识别变动维度

桥接模式是典型的“**组合优于继承**”思想，适用于**多个维度独立变化的系统设计**。