## 背景故事

你正在开发一个文件资源管理器系统。一个文件夹（Folder）中可以包含：

- 单个文件（File）
- 多个文件夹（Folder）

用户希望**统一操作**这些资源，比如：

- 递归展示所有文件夹/文件
- 统计整体大小
- 批量删除

此时你面临的问题是：

- **文件与文件夹行为不同**：一个是叶子节点，一个是容器节点
- 但用户希望**以统一方式处理它们**，不关心它到底是文件还是文件夹

组合模式就是解决这种“**部分-整体**”结构统一处理的问题。

## 代码演示

抽象组件接口

```cs
public abstract class FileSystemItem
{
    protected string name;

    public FileSystemItem(string name)
    {
        this.name = name;
    }

    public abstract void Display(int indent = 0);
}
```

叶子节点：文件

```cs
public class File : FileSystemItem
{
    public File(string name) : base(name) { }

    public override void Display(int indent = 0)
    {
        Console.WriteLine($"{new string(' ', indent)}- 文件: {name}");
    }
}
```

组合节点：文件夹

```cs
public class Folder : FileSystemItem
{
    private List<FileSystemItem> children = new();

    public Folder(string name) : base(name) { }

    public void Add(FileSystemItem item)
    {
        children.Add(item);
    }

    public override void Display(int indent = 0)
    {
        Console.WriteLine($"{new string(' ', indent)}+ 文件夹: {name}");
        foreach (var child in children)
        {
            child.Display(indent + 2);
        }
    }
}
```

客户端调用

```cs
class Program
{
    static void Main()
    {
        Folder root = new Folder("根目录");
        root.Add(new File("readme.txt"));

        Folder src = new Folder("src");
        src.Add(new File("main.cs"));
        src.Add(new File("utils.cs"));

        Folder docs = new Folder("docs");
        docs.Add(new File("design.md"));

        root.Add(src);
        root.Add(docs);

        root.Display();
    }
}
```

## 定义

> **组合模式（Composite）**：将对象组合成树形结构以表示“部分-整体”的层次结构。组合模式使得客户端可以**统一处理单个对象和组合对象**。

本质是：将叶子对象和容器对象统一对待。

<import filepath="./UML/8.puml" />

## 应用场景

组合模式是处理树形结构最常用的设计模式之一，它强调**一致性 API、递归处理能力、模块可扩展性**。

> 1. 需要处理“部分-整体”结构（如文件系统）
> 2. 客户端需统一操作叶子与组合对象
> 3. 系统有递归需求，结构层级不固定

**场景 1：文件系统**

文件与文件夹统一抽象为“资源项”，便于递归处理

**场景 2：UI 元素树**

按钮、面板、窗口等都可以组合成一个 UI 层级树

**场景 3：组织架构**

员工（Employee）和部门（Department）组合成一棵管理树

## 总结

优点

- **统一接口**：客户端统一处理单个对象和组合结构
- **递归结构简洁**：天然适用于树形结构
- **新增节点简单**：增加新类型节点无须改动原结构

缺点
- 不适用于层级严格或规则复杂的结构（如关系图而非树）
- 若叶子和组合有显著不同，强行统一接口会导致**接口膨胀**