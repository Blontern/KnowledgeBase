## 背景故事

假设你在开发一个文件导入框架，支持多种格式（如 CSV、XML、JSON）。导入流程通常包括：

1. 打开文件
2. 读取数据
3. 校验格式
4. 存入数据库
5. 关闭文件

不同格式的文件在第2步“读取数据”及第3步“校验格式”上差异较大，其余步骤高度相似。

若你为每种格式单独开发一套流程，会造成大量重复代码。

这时，模板方法模式允许你定义一个**通用处理框架**，将通用流程“固化”下来，仅允许子类重写差异步骤。

## 代码演示

模板类

```cs
public abstract class FileImporter
{
    public void Import()
    {
        OpenFile();
        ReadData();      // 允许子类重写
        ValidateFormat(); // 允许子类重写
        SaveToDatabase();
        CloseFile();
    }

    protected void OpenFile() => Console.WriteLine("打开文件");
    protected abstract void ReadData();
    protected abstract void ValidateFormat();
    protected void SaveToDatabase() => Console.WriteLine("保存到数据库");
    protected void CloseFile() => Console.WriteLine("关闭文件");
}
```

模板子类

```cs
public class CsvImporter : FileImporter
{
    protected override void ReadData() => Console.WriteLine("读取 CSV 数据");
    protected override void ValidateFormat() => Console.WriteLine("校验 CSV 格式");
}

public class JsonImporter : FileImporter
{
    protected override void ReadData() => Console.WriteLine("解析 JSON 数据");
    protected override void ValidateFormat() => Console.WriteLine("校验 JSON 格式");
}
```

客户端

```cs
FileImporter importer = new CsvImporter();
importer.Import();

importer = new JsonImporter();
importer.Import();
```

## 定义

> **模板方法模式（Template Method）**：定义一个算法的骨架（步骤顺序），并允许子类在不改变结构的前提下**重写某些具体步骤**。

通俗来说，就是**父类定流程、子类补细节**。

<import filepath="./UML/22.puml" />

## 应用场景

定义一个算法的骨架，允许子类实现某些步骤的场景。常用于框架的开发、代码复用、自动化流程等。

|场景类型|示例|
|---|---|
|数据处理框架|读取数据 → 解析数据 → 校验数据 → 写入数据库|
|流程控制框架|表单提交前校验 → 数据处理 → 响应构建|
|游戏角色行为|执行AI → 选择目标 → 发动技能 → 渲染效果|
|单元测试框架|准备环境 → 执行测试 → 清理资源|

## 总结

**优点**

- 封装通用逻辑，复用基础代码
- 子类仅需实现可变部分，避免重复逻辑
- 遵守开闭原则，流程结构稳定可继承扩展

**缺点**

- 过度依赖继承（无法动态切换步骤）
- 每个可变步骤都需继承，灵活性稍弱于策略模式